[â¬…ï¸ ä¸Šä¸€ç« ](ç¬¬ä¸€ç« .md) | [ğŸ“– ç›®éŒ„](README.md) | [ä¸‹ä¸€ç«  â¡ï¸](ç¬¬ä¸‰ç« .md)
# **ç¬¬äºŒç« ï¼š ç¨‹å¼èªªæ˜**

**[ğŸ’¾å®Œæ•´çš„ç¨‹å¼åœ¨æ­¤](AI_Chat_bot(å¯å…¬é–‹ç‰ˆæœ¬).py)**  

åœ¨èªªæ˜ç¨‹å¼ä¹‹å‰ï¼Œè«‹å…ˆå®‰è£å¥½ç›¸é—œå¥—ä»¶ï¼š  

é–‹ç™¼ç’°å¢ƒï¼šPyCharm venv(Python 3.12.7)  
ä½¿ç”¨å¥—ä»¶ï¼špy-cordã€requests  

âœ… py-cordå·²ç¶“åŒ…å«äº†è¨±å¤šé¡ä¼¼asyncioçš„å¸¸ç”¨å‡½å¼åº«ï¼Œä¸éœ€é¡å¤–å†æ‰‹å‹•å®‰è£  

âš ï¸ ç”±æ–¼py-cordçš„æ©Ÿå™¨äººåœ¨åŸ·è¡Œæ™‚æœƒç”¢ç”Ÿä¸€å€‹**ç„¡é™å¾ªç’°çš„äº‹ä»¶è¿´åœˆ**ï¼Œé€™å€‹**äº‹ä»¶è¿´åœˆæœƒèˆ‡Jupiter Notebookã€Colabé¡å‹çš„ç¨‹å¼ç’°å¢ƒäº’ç›¸è¡çª**ï¼ˆå› ç‚ºé€™é¡é–‹ç™¼ç’°å¢ƒåŸ·è¡Œæ™‚ä¹Ÿæœ‰è‡ªå·±çš„äº‹ä»¶è¿´åœˆï¼‰ï¼Œæ‰€ä»¥ä½¿ç”¨ç¨‹å¼ç¢¼çš„æ™‚å€™**å¿…é ˆåœ¨å‚³çµ±çš„Pythoné–‹ç™¼ç’°å¢ƒä¸­åŸ·è¡Œ**ï¼Œæ‰èƒ½æ­£å¸¸é‹ä½œã€‚  
```bash
#å®‰è£ç›¸é—œå¥—ä»¶çš„powershellç¨‹å¼ç¢¼
pip install -q py-cord
pip install -q requests
```


1. é¦–å…ˆï¼Œå…ˆå°å…¥è¦ä½¿ç”¨çš„å¥—ä»¶ï¼š  
	```Python
	#å°å…¥åˆå§‹å¥—ä»¶
	import discord
	import asyncio                           #clean inactive user's chat history will use this module
	from datetime import datetime,timedelta  #print time log and check inactive user's chat
	import requests                          #call Groq API
	```


2. è¨­å®šåˆå§‹è³‡æ–™ï¼šGroq API Keyã€Discord Bot API Keyã€å¯ç”¨çš„ Groq æ¨¡å‹åˆ—è¡¨  
   å…¶ä¸­ï¼Œå„²å­˜ä½¿ç”¨è€…è³‡æ–™çš„ data å­—å…¸æ ¼å¼å¦‚ä¸‹ï¼š  
	```python
	# é€™ä¸æ˜¯ç¨‹å¼ç¢¼ï¼Œåªæ˜¯èªªæ˜dataçš„è³‡æ–™çµæ§‹ï¼Œè®Šæ•¸åç¨±ä¹Ÿå·²ç¶“ä¿®æ”¹ä»¥å¢é€²å¯è®€æ€§
	# ä½¿ç”¨ä¼ºæœå™¨IDã€ä½¿ç”¨è€…IDä½œç‚ºç´¢å¼•ï¼Œå¯ä»¥é¿å…ä½¿ç”¨è€…é‡åã€ä¼ºæœå™¨é‡åçš„å•é¡Œ
	data = {
	   ä¼ºæœå™¨ID0: {
		   ä½¿ç”¨è€…ID0: {
			   'display_name': ä½¿ç”¨è€…æš±ç¨±,
			   'last_active': ä¸Šæ¬¡æ´»èºæ™‚é–“,
			   'chat_history': [
				   {'role': 'user', 'content': ä½¿ç”¨è€…çš„å•é¡Œ},
				   {'role': 'assistant', 'content': Groq å›æ‡‰}
				],
				'guild_name': ä¼ºæœå™¨æš±ç¨±
			},
			ä½¿ç”¨è€…ID1: {}
		},
		ä¼ºæœå™¨ID1: {}
	}
	```


	ä»¥ä¸‹æ˜¯ç¨‹å¼ç¢¼ï¼š  
	```Python
	#è¨­å®šåˆå§‹è³‡æ–™
	Groq_api_key= '<Your Groq API Key>'
	DiscordBot_api_key= '<Your Discord Bot API Key>'
	model_list = [
	    [ 'llama-3.3-70b-versatile', 32768 ],
	    [ 'deepseek-r1-distill-llama-70b', 131072 ],
	    [ 'qwen-qwq-32b', 131072 ],
	    [ 'meta-llama/llama-4-maverick-17b-128e-instruct', 8192 ],
	    [ 'meta-llama/llama-4-scout-17b-16e-instruct', 8192 ]
	]
	model_names = [model[0] for model in model_list]  #slash command: /change_model will use this list
	model_now = model_list[0][0]                      #the default model is the first model in model_list, you can change it by using /change_model command
	max_tokens = model_list[0][1]                     #the default max_tokens is the first model's max_tokens, you can change it by using /change_model command
	data = {}                                         #all user's chat history will be stored in this dictionary
	```


3. è¨­å®šé€™å€‹Discordæ©Ÿå™¨äººçš„æ„åœ–ï¼ˆIntentsï¼‰

	å› ç‚ºæˆ‘çš„æ©Ÿå™¨äººåªæœƒèˆ‡Discordç©å®¶ä¼ºæœå™¨äº’å‹•ï¼Œä¸¦ä¸”åªæœƒè¢«æ–œç·šå‘½ä»¤ï¼ˆ`/slash commands`ï¼‰å‘¼å«ï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦æœ€åŸºç¤çš„guildsæ¬Šé™å³å¯  

	å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé€™å€‹IntentsåŒæ™‚ä¹Ÿä»£è¡¨äº†é€™å€‹æ©Ÿå™¨äºº**è¨‚é–±äº†å“ªäº›Discordçš„æœå‹™**ï¼Œä¹Ÿå°±æ˜¯èªªï¼Œç•¶Discordè§¸ç™¼äº†ç›¸æ‡‰çš„äº‹ä»¶ï¼Œå¦‚æœä½ çš„æ©Ÿå™¨äººæœ‰è¨‚é–±ç›¸æ‡‰äº‹ä»¶ï¼Œå°±æœƒè¢«å‘¼å«ä¸€æ¬¡è™•ç†äº‹ä»¶ï¼Œé€™æœƒé€ æˆä¸å¿…è¦çš„ç³»çµ±è³‡æºæ¶ˆè€—  

	âœ…å¯ä»¥çš„è©±ï¼Œç›¡é‡åªè¨‚é–±æœ€ä½é™åº¦ä½†å¿…è¦çš„Intentså°±å¥½  
	```Python
	#set up intents
	intents = discord.Intents(guilds=True)
	bot = discord.Bot(intents=intents)
	```


4. è‡ªè¨‚å‡½å¼ï¼šå‘¼å«Groq API  
	é€™å€‹è‡ªè¨‚å‡½å¼æ¥æ”¶listå½¢å¼çš„ä½¿ç”¨è€…å°è©±ç´€éŒ„ï¼Œä¸¦ä½¿ç”¨`request.post`æ–¹æ³•æŠŠè¨Šæ¯å‚³çµ¦Groq APIï¼Œä¸¦å–å¾—å›æ‡‰ï¼Œå°‡å›æ‡‰è§£æå¾Œå›å‚³  
	```Python
	#call Groq API by requests module, messages is user's chat history
	def call_groq_api(messages):
	    url = 'https://api.groq.com/openai/v1/chat/completions'
	    headers = {'Authorization': f'Bearer {Groq_api_key}','Content-Type': 'application/json'}
	    payload = {'model': model_now,'messages': messages,'temperature': 0.6,'max_tokens': max_tokens}
	    try:
	        with requests.post(url, headers=headers, json=payload) as response:
	            response.raise_for_status()  #if http status code is not 200, raise an exception
	            return response.json()['choices'][0]['message']['content']
	    #Exception handling
	    except requests.exceptions.ConnectionError:
	        print('Network connection error')
	        return 'Network connection error, please check your internet connection'
	    except requests.exceptions.Timeout:
	        print('Request timeout')
	        return 'API request timeout, please try again later'
	    except requests.exceptions.HTTPError as e:
	        print(f'HTTP error{e}')
	        return 'HTTP error'
	    except Exception as e:
	        print(f'Unexpected error: {e}')
	        return 'Unexpected error'
	```


5. è‡ªè¨‚å‡½å¼ï¼šä¸æ´»èºå°è©±ç´€éŒ„æª¢æŸ¥å™¨

	é€™å€‹è‡ªè¨‚å‡½å¼æœƒè¢«py-cordçš„äº‹ä»¶è¿´åœˆå¾ªç’°å‘¼å«ï¼Œæ¯éš”ä¸€å°æ™‚æœƒæª¢æŸ¥ä¸€æ¬¡ä¸æ´»èºçš„å°è©±ç´€éŒ„ï¼Œç„¶å¾Œæ¸…é™¤è¶…éå…©å€‹å°æ™‚æ²’ä½¿ç”¨çš„å°è©±ç´€éŒ„

	âš ï¸ç°¡å–®èªªæ˜ä¸€ä¸‹ï¼Œä½ ä¸èƒ½**åœ¨èµ°è¨ªå­—å…¸çš„æ™‚å€™åˆªé™¤å­—å…¸çš„éµå€¼å°**ï¼Œæ­£ç¢ºçš„åšæ³•æ˜¯å…ˆå»ºç«‹è¦åˆªé™¤çš„å­—å…¸éµæ¸…å–®ï¼Œå¾…èµ°è¨ªå®Œç›®æ¨™å­—å…¸å¾Œå†åˆªé™¤å…¶å…§å®¹  
	```Python
	#check inactive user's chat history every 3600 seconds(1 hour) and delete them if they have been inactive for more than 2 hours.
	#this function will be called by asyncio.create_task() and will run in a background thread.
	async def chat_history_auto_cleaner():
	    while True:
	        await asyncio.sleep(3600)
	        time_now = datetime.now()
	        print(f'{time_now} Checking Inactive User History...')
	        cutoff_time = time_now - timedelta(hours=2)
	        #make a copy of data avoid modifying the original data while iterating through it
	        inactive_user = []
	        for guild_id, users in data.items():
	            for user_id, user_data in users.items():
	                if user_data['last_active'] < cutoff_time:
	                    inactive_user.append((guild_id, user_id))
	                    print(f'{time_now} User {user_data['display_name']} in guild {user_data['guild_name']} has been inactive for more than 2 hours.')
	        #delete inactive user's chat history from data dictionary
	        for guild_id, user_id in inactive_user:
	            del data[guild_id][user_id]
	            if not data[guild_id]:
	                del data[guild_id]
	        print(f'{time_now} Inactive User History Cleaned.')
	```


6. è‡ªè¨‚å‡½å¼ï¼šè‡ªè¨‚å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼ˆexitï¼‰

	![exitå‘½ä»¤åµæ¸¬](pictures/ç¬¬äºŒç« _01.jpg)

	é€™å€‹è‡ªè¨‚å‡½å¼æœƒè¢«py-cordçš„äº‹ä»¶è¿´åœˆå¾ªç’°å‘¼å«ï¼Œéš¨æ™‚åµæ¸¬consoleè¼¸å…¥çš„å…§å®¹ï¼Œå¦‚æœè¼¸å…¥çš„å…§å®¹åŒ…å«`exit`ï¼Œå‰‡å®‰å…¨åœ°å°‡æ©Ÿå™¨äººé›¢ç·šï¼Œä¸¦çµæŸæ•´å€‹ç¨‹å¼  
	```Python
	#console command handler, this function will be called by asyncio.create_task() and will run in a background thread.
	#close bot when user enter 'exit' in console.
	async def console_command_handler():
	    while True:
	        command = await asyncio.to_thread(input, '>>> ')
	        command = command.strip()
	        if 'exit' in command:
	            print('Detected the exit command, closing bot.')
	            await bot.close()
	        else:
	            print(f'Unrecognized command: {command}, please try again.')
	```  


7. è‡ªè¨‚é¡ï¼ˆclassï¼‰ï¼šå½ˆå‡ºå¼Discordè¡¨å–®

	![Discordä¸Šçš„å½ˆå‡ºè¡¨å–®](pictures/ç¬¬äºŒç« _02.jpg)

	é€™å€‹è¡¨å–®æ˜¯ç”¨ä¾†å¡«å…¥å¤šè¡Œè¨Šæ¯çš„ï¼Œå—é™æ–¼Discord slash commandsåªèƒ½è¼¸å…¥å–®è¡Œè¨Šæ¯ï¼Œå¦‚æœæƒ³è¦è«‹AIè§£é‡‹å¤§é‡çš„å…§å®¹æ™‚ï¼Œè¤‡è£½è²¼ä¸Šä¹Ÿæœƒè¢«é˜»æ“‹ã€‚å› æ­¤ç‰¹åœ°å¯«ä¸€å€‹Classï¼Œç•¶`/set_data`å‘½ä»¤è¢«åŸ·è¡Œæ™‚ï¼Œåœ¨ä½¿ç”¨è€…ç•«é¢ä¸Šè·³å‡ºè¡¨å–®ï¼Œ**å¡«å…¥æƒ³è¦è®“AIåƒè€ƒçš„è³‡æ–™**  

	æœ‰äº†åƒè€ƒè³‡æ–™ï¼ŒAIå°±ä¸æœƒäº‚ç­”ä½¿ç”¨è€…çš„å•é¡Œäº†  

	ä½¿ç”¨è€…åœ¨é€™è£¡è¼¸å…¥çš„åƒè€ƒè³‡æ–™ï¼Œæœƒè¢«ç•¶ä½œ'system'è§’è‰²è³‡æ–™ï¼Œè¢«å­˜å…¥ä½¿ç”¨è€…çš„å°è©±ç´€éŒ„ï¼Œç­‰åˆ°ä½¿ç”¨è€…è¼¸å…¥å•é¡Œæ™‚ï¼Œæ‰æœƒè¢«ä¸€ä½µç™¼é€çµ¦Groq API

	å­˜å…¥ä½¿ç”¨è€…å°è©±ç´€éŒ„ä¹‹å‰ï¼Œç¨‹å¼æœƒå…ˆæª¢æŸ¥ä½¿ç”¨è€…è³‡æ–™æ˜¯å¦å­˜åœ¨ï¼Œå†æ±ºå®šæ–°å»ºä½¿ç”¨è€…è³‡æ–™ï¼Œé‚„æ˜¯æŠŠè³‡æ–™åŠ å…¥æ—¢æœ‰ä½¿ç”¨è€…è³‡æ–™å…§ã€‚ä»¥ä¸‹æ˜¯ç¨‹å¼ç¢¼ï¼š  
	```Python
	#generate a multi-line input interface in discord. this interface pops up when a user uses the /set_data command.
	class SetData(discord.ui.Modal):
	    #set up a modal interface
	    def __init__(self):
	        super().__init__(title='è¼¸å…¥è³‡æ–™')
	        self.add_item(discord.ui.InputText(label='å¡«å¯«ä½ å¸Œæœ›AIä½¿ç”¨çš„åƒè€ƒè³‡æ–™',placeholder='ä¾‹ï¼šè«‹ä¾ç…§é€™ä»½å¤©æ°£è³‡æ–™å›æ‡‰+ä½ çš„è³‡æ–™',style=discord.InputTextStyle.long))
	    #when user click submit button, this function will be called
	    async def callback(self, interaction: discord.Interaction):
	        await interaction.response.defer()
	        system_prompt = self.children[0].value
	        #check if the user has data already
	        if interaction.guild.id in data and interaction.user.id in data[interaction.guild.id]:
	            data[interaction.guild.id][interaction.user.id]['last_active'] = datetime.now()
	            data[interaction.guild.id][interaction.user.id]['chat_history'].append({'role': 'system', 'content': system_prompt})
	        else:
	            data.setdefault(interaction.guild.id, {}).setdefault(interaction.user.id, {
	                'display_name': interaction.user.display_name,
	                'last_active': datetime.now(),
	                'chat_history': [{'role': 'system', 'content': system_prompt}],
	                'guild_name': interaction.guild.name
	            })
	        response = f'å·²è¨­å®šAIè¦åƒè€ƒçš„è³‡æ–™ï¼š\n{system_prompt}'
	        if len(response) > 1900:
	            for i in range(0, len(response), 1900):
	                await interaction.followup.send(response[i:i+1900])
	        else:
	            await interaction.followup.send(response)
	        print(f'{datetime.now()} [{interaction.guild.name}] - [{interaction.user.display_name}]\'s Preset data has been added')
	```  

	â­  å‰é¢çš„è‡ªè¨‚ç¨‹å¼éƒ½åªæ˜¯**æ­é…æ©Ÿå™¨äººé‹ä½œçš„åŠŸèƒ½**ï¼Œæ¥ä¸‹ä¾†æ‰æ˜¯æ©Ÿå™¨äººèƒ½å¤ æ­£å¸¸é‹ä½œçš„é—œéµ

	æ©Ÿå™¨äººæˆåŠŸ**å•Ÿå‹•å¾Œçš„å‹•ä½œ**ã€**æ‰€æœ‰æ©Ÿå™¨äººçš„/slash commands**éƒ½åœ¨å¾Œé¢æè¿°  


8. py-cordäº‹ä»¶ï¼šç•¶æ©Ÿå™¨äººä¸Šç·š(bot.event on_ready)

	é€™è£¡ä½ å¯ä»¥è‡ªè¨‚**ç•¶æ©Ÿå™¨äººä¸Šç·šå¾Œè¦åšçš„å‹•ä½œ**ï¼Œç°¡å–®æè¿°ä¸€ä¸‹æˆ‘é€™è£¡çš„è¨­å®šï¼š  
	2. å¾Œå°åˆ—å°ï¼šæ©Ÿå™¨äººå·²æˆåŠŸä¸Šç·šï¼Œä½¿ç”¨çš„æ©Ÿå™¨äººåç¨±ç‚ºï¼š`æ©Ÿå™¨äººåç¨±#ä»£è™Ÿ`  
	3. å¾Œå°åˆ—å°ï¼šæ©Ÿå™¨äººæœå‹™çš„ä¼ºæœå™¨åˆ—è¡¨  
	4. å¾Œå°è¡Œç‚ºï¼šç­‰å¾…åŒæ­¥æ‰€æœ‰çš„slash commands  
	5. è¨»å†Šäº‹ä»¶ï¼šå°‡è‡ªå‹•æ¸…ç†å°è©±ç´€éŒ„çš„è‡ªè¨‚å‡½å¼è¨»å†Šåˆ°py-cordçš„äº‹ä»¶è¿´åœˆ(å¾ªç’°åŸ·è¡Œ)  
	6. è¨»å†Šäº‹ä»¶ï¼šå°‡åµæ¸¬å¾Œå°å‘½ä»¤`exit`çš„è‡ªè¨‚å‡½å¼è¨»å†Šåˆ°py-cordçš„äº‹ä»¶è¿´åœˆ(å¾ªç’°åŸ·è¡Œ)
 
	on_readyæ™‚çš„å¾Œå°è¼¸å‡ºç•«é¢ï¼š
	![on_readyæ™‚çš„å¾Œå°è¼¸å‡ºç•«é¢](pictures/ç¬¬äºŒç« _03.jpg)

	```Python
	@bot.event
	async def on_ready():
	    print(f'{datetime.now()} â˜‘ AI Chat Bot is now online, identifier {bot.user}')
	    print(f'{datetime.now()} â˜‘ Joined the following servers:')
	    for guild in bot.guilds:
	        print(f'{datetime.now()} â˜º {guild.name}ï¼ˆID: {guild.id}ï¼‰')
	    print(f'{datetime.now()}')
	    await bot.sync_commands()
	    print(f'{datetime.now()} â˜‘ slash commands synced')
	    bot.loop.create_task(chat_history_auto_cleaner())
	    print(f'{datetime.now()} â˜‘ Chat history auto cleaner activated')
	    bot.loop.create_task(console_command_handler())
	    print(f'{datetime.now()} â˜‘ console command handler activated')
	```

9. Discordæ–œç·šå‘½ä»¤ï¼š/ask_ai

	![/ask_aiçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _04.jpg)  
	
	é€™æ˜¯æ©Ÿå™¨äººæœ€ä¸»è¦ä¹Ÿæœ€å¸¸è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ŒåŠŸèƒ½æ˜¯å•AIå•é¡Œ  
	
	ç•¶éµå…¥`/ask_ai`å¾Œï¼Œå¾Œé¢æœ‰ä¸€å€‹åç‚º`question`çš„åƒæ•¸å¯è¼¸å…¥å•é¡Œï¼Œè¼¸å…¥å®Œå•é¡Œå¾ŒåŸ·è¡Œï¼Œæ©Ÿå™¨äººæœƒæŠŠå•é¡Œä¸Ÿçµ¦AIä¸¦å–å¾—å›æ‡‰  
	
	ç¨‹å¼çš„åŸ·è¡Œä¸Šï¼Œå› ç‚ºé€™å€‹æ©Ÿå™¨äººå…·æœ‰å°è©±è¨˜æ†¶åŠŸèƒ½ï¼Œå¯ä»¥è·Ÿæ©Ÿå™¨äººä¾†å›å°è©±ï¼Œæ‰€ä»¥åŸ·è¡Œä¸Šéœ€è¦å…ˆæª¢æŸ¥å°è©±ç´€éŒ„æ˜¯å¦å·²ç¶“å­˜åœ¨ï¼š  
	1. å°è©±ç´€éŒ„å·²å­˜åœ¨ï¼šå…ˆå°‡ä½¿ç”¨è€…å•é¡ŒåŠ å…¥åˆ°å°è©±ç´€éŒ„ï¼Œå†å°‡å°è©±ç´€éŒ„æ‹¿å»å‘¼å«å‰é¢æéçš„call_groq_api(é€™é‚Šå‚³å…¥ä½¿ç”¨è€…çš„å°è©±ç´€éŒ„)  
	2. å°è©±ç´€éŒ„ä¸å­˜åœ¨ï¼šæ–°å¢ä¸€ç­†ä½¿ç”¨è€…çš„è³‡æ–™ï¼Œä¸¦æŠŠä½¿ç”¨è€…çš„å•é¡Œæ‹¿å»å‘¼å«call_groq_api( )  
	
	ç•¶å–å¾—Groq APIçš„å›å‚³è³‡æ–™å¾Œï¼Œç¨‹å¼æœƒæŠŠAIçš„è³‡æ–™ç•¶ä½œã€Œassistantã€ä¸¦ä¸”ç´€éŒ„åˆ°ä½¿ç”¨è€…çš„å°è©±ç´€éŒ„è£¡é¢  

	éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDiscordçš„æ¯å‰‡è¨Šæ¯é•·åº¦éƒ½æœ‰2000å­—å…ƒé•·åº¦çš„é™åˆ¶ï¼Œå¦‚æœæ©Ÿå™¨äººç™¼é€çš„AIå›è¦†è¶…éäº†å­—æ•¸é™åˆ¶ï¼Œå‰‡æœƒå°è‡´ç™¼é€å¤±æ•—çš„éŒ¯èª¤ã€‚
	
 	è§£æ±ºçš„è¾¦æ³•ä¹Ÿå¾ˆç°¡å–®ï¼Œåªè¦åˆ¤æ–·AIå›è¦†æ˜¯å¦è¶…é1900å­—å…ƒï¼ˆç•™ä¸€äº›å†—é¤˜ç©ºé–“ï¼‰ï¼Œåˆ‡é–‹å…§å®¹å†åˆ†æ¬¡ç™¼é€å³å¯ã€‚
	```Python
	@bot.slash_command(name='ask_ai', description='æå‡ºä½ çš„å•é¡Œ')
	async def ask_ai(ctx: discord.ApplicationContext, question: str):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /ask_ai')
	    #check if the user has data already
	    if ctx.guild.id in data and ctx.author.id in data[ctx.guild.id]:
	        data[ctx.guild.id][ctx.author.id]['last_active'] = datetime.now()
	        data[ctx.guild.id][ctx.author.id]['chat_history'].append({"role": "user", "content": question})
	    else:
	        data.setdefault(ctx.guild.id, {}).setdefault(ctx.author.id, {
	            'display_name': ctx.author.display_name,
	            'last_active': datetime.now(),
	            'chat_history': [{'role': 'user', 'content': 'è«‹ç”¨å°ç£äººç¿’æ…£çš„ä¸­æ–‡å›æ‡‰ï¼Œæˆ‘çš„å•é¡Œæ˜¯ï¼š'+question}],
	            'guild_name': ctx.guild.name
	        })
	    #call Groq API and get response
	    response = call_groq_api(data[ctx.guild.id][ctx.author.id]['chat_history'])
	    data[ctx.guild.id][ctx.author.id]['chat_history'].append({"role": "assistant", "content": response})
	    #if response too long, split it into multiple messages and send them one by one
	    response = 'Q: \n'+question+'\nA: \n'+response
	    if len(response) > 1900:
	        for i in range(0, len(response), 1900):
	            await ctx.followup.send(response[i:i+1900])
	    else:
	        await ctx.followup.send(response)
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}]\'s reply has been sent')
 	```


11. Discordæ–œç·šå‘½ä»¤ï¼š/set_data  

 	![/set_dataçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _02.jpg)  

  	é€™å€‹æŒ‡ä»¤å¾ˆç°¡å–®ï¼ŒåŠŸèƒ½æ˜¯è®“ä½¿ç”¨è€…å¯ä»¥å¤šè¡Œè¼¸å…¥ã€Œæƒ³è¦è®“AIåƒè€ƒçš„è³‡è¨Šã€  
	
	ç•¶ä½¿ç”¨è€…ä½¿ç”¨`/set_data`æŒ‡ä»¤å¾Œï¼ŒDiscordç•«é¢å°±æœƒè·³å‡ºå‰é¢æéçš„è¡¨å–®(class)ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥å¤šè¡Œè¼¸å…¥è³‡æ–™
	```Python
	@bot.slash_command(name='set_data', description='è¼¸å…¥çµ¦AIåƒè€ƒçš„è³‡æ–™(Exï¼šç¨‹å¼ç¢¼)')
	async def set_data(ctx: discord.ApplicationContext):
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /set_data')
	    await ctx.send_modal(SetData())
	```  


12. Discordæ–œç·šå‘½ä»¤ï¼š/clear_memory

	![/clear_memoryçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _05.jpg)  

	ç•¶é€™å€‹æŒ‡ä»¤è¢«è§¸ç™¼æ™‚ï¼Œæ¸…é™¤æŒ‡ä»¤ä½¿ç”¨è€…çš„å°è©±ç´€éŒ„  

	æœ‰æ™‚å€™æˆ‘å€‘å•å•é¡Œçš„æ™‚å€™ï¼Œå°è©±Tokensæœƒè¶…éæœ€å¤§ä¸Šé™ï¼Œå¦‚æœç­‰å¾…å…©å€‹å°æ™‚çš„è‡ªå‹•æ¸…é™¤æœƒå¤ªæ…¢  

	æ‰€ä»¥é€™è£¡æä¾›ä¸€å€‹å‘½ä»¤ï¼Œè®“ä½¿ç”¨è€…æ¸…é™¤è‡ªå·±çš„ç´€éŒ„ï¼Œå†ç¹¼çºŒå•å•é¡Œã€‚  

	ç¨‹å¼æœƒæª¢æŸ¥è©²ä½¿ç”¨è€…çš„å°è©±ç´€éŒ„æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œå‰‡æ¸…é™¤ï¼›å¦å‰‡å›å‚³ã€Œæ²’æœ‰å°è©±ç´€éŒ„å¯æ¸…é™¤ã€
	```Python
	@bot.slash_command(name='clear_memory', description='æ¸…é™¤å°è©±ç´€éŒ„&åƒè€ƒè³‡æ–™')
	async def clear_memory(ctx: discord.ApplicationContext):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /clear_memory')
	    if ctx.guild.id in data and ctx.author.id in data[ctx.guild.id]:
	        del data[ctx.guild.id][ctx.author.id]
	        if not data[ctx.guild.id]:
	            del data[ctx.guild.id]
	        await ctx.followup.send(f'å·²æ¸…é™¤[{ctx.guild.name}] - [{ctx.author.display_name}]çš„å°è©±ç´€éŒ„')
	    else:
	        await ctx.followup.send(f'æŸ¥ç„¡[{ctx.guild.name}] - [{ctx.author.display_name}]çš„å°è©±ç´€éŒ„')
	```    


13. Discordæ–œç·šå‘½ä»¤ï¼š/model_info

	![/model_infoçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _06.jpg)  

	è³‡è¨Šæä¾›å‹çš„æ–œç·šå‘½ä»¤ï¼ŒåŠŸèƒ½æ˜¯é¡¯ç¤ºç›®å‰æ•´åœ¨ä½¿ç”¨çš„æ¨¡å‹ä»¥åŠä»–çš„æœ€å¤§Tokensï¼Œè¢«ä½¿ç”¨è€…è§¸ç™¼å¾Œç«‹åˆ»å›å‚³è¨Šæ¯
	```Python
	@bot.slash_command(name='model_info', description='é¡¯ç¤ºç•¶å‰ä½¿ç”¨æ¨¡å‹çš„è³‡è¨Š')
	async def model_info(ctx: discord.ApplicationContext):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /model_info')
	    await ctx.followup.send(f'Model Name: `{model_now}`\nMax Tokens: {max_tokens}\n')
	```  


14. Discordæ–œç·šå‘½ä»¤ï¼š/available_models

	![/available_modelsçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _07.jpg)   

 	èˆ‡`/model_info`é¡ä¼¼ï¼ŒåŠŸèƒ½æ˜¯é¡¯ç¤ºç›®å‰æœ‰å“ªäº›æ¨¡å‹å¯ä»¥ä½¿ç”¨ï¼Œä»¥åŠé€™äº›æ¨¡å‹å¯ç”¨çš„æœ€å¤§Tokensï¼Œè¢«ä½¿ç”¨è€…è§¸ç™¼å¾Œç«‹åˆ»å›å‚³è¨Šæ¯

	```Python
	@bot.slash_command(name='available_models', description='é¡¯ç¤ºç•¶å‰å¯åˆ‡æ›çš„æ¨¡å‹åˆ—è¡¨')
	async def available_models(ctx: discord.ApplicationContext):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /model_list')
	    response = '### å¯ç”¨çš„æ¨¡å‹å¦‚ä¸‹:\n\n'
	    for name,tokens in model_list:
		response += f'`{name}`  (Max Tokens: {tokens})\n'
	    await ctx.followup.send(response)
	```    

15. Discordæ–œç·šå‘½ä»¤ï¼š/change_model

	![/change_modelçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _08.jpg)  
	![/change_modelçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _09.jpg)  

 	é¸å–®å¼çš„æ–œç·šå‘½ä»¤ï¼Œå¯é¸é …ä¾†è‡ªæ–¼å¾model_list[list]æå–çš„model_names[list]  

  	ç•¶ä½¿ç”¨è€…é¸å–å®Œæ¨¡å‹ä¸¦é€å‡ºå‘½ä»¤å¾Œï¼Œå…¨åŸŸè®Šæ•¸model_nowèˆ‡max_tokensæœƒè¢«æ›¿æ›æˆæŒ‡å®šçš„æ¨¡å‹

	```Python
	@bot.slash_command(name='change_model', description='åˆ‡æ›ä½¿ç”¨çš„æ¨¡å‹')
	async def change_model(ctx: discord.ApplicationContext, model: discord.Option(str, choices=model_names)):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /change_model')
	    global model_now, max_tokens
	    model_now = model
	    for model_name, max_tokens in model_list:
	        if model_name == model:
	            max_tokens = max_tokens
	            break
	    await ctx.followup.send(f'å·²å°‡æ¨¡å‹åˆ‡æ›ç‚ºï¼š {model}')
	```    

16. Discordæ–œç·šå‘½ä»¤ï¼š/get_help

	![/get_helpçš„æ–œç·šå‘½ä»¤](pictures/ç¬¬äºŒç« _10.jpg)  

 	è³‡è¨Šæä¾›å‹çš„æ–œç·šå‘½ä»¤ï¼ŒåŠŸèƒ½æ˜¯é¡¯ç¤ºä¸€äº›å°æç¤ºï¼Œåœ¨è§¸ç™¼å¾Œå›å‚³è³‡æ–™

	```Python
	@bot.slash_command(name='get_help', description='é¡¯ç¤ºä½¿ç”¨èªªæ˜')
	async def get_help(ctx: discord.ApplicationContext):
	    await ctx.defer()
	    print(f'{datetime.now()} [{ctx.guild.name}] - [{ctx.author.display_name}] used command /help')
	    response = """
	## Discord AI Chat Bot
	
	### å¯ç”¨çš„å‘½ä»¤:
	`/ask_ai          `    -- è¼¸å…¥ä½ è¦å•çš„å•é¡Œ
	`/set_data        `    -- è¨­å®šæ¨¡å‹è¦åƒè€ƒçš„è³‡æ–™(å¯å¤šè¡Œè¼¸å…¥)
	`/clear_memory    `    -- æ¸…é™¤å°è©±ç´€éŒ„&åƒè€ƒè³‡æ–™
	`/model_info      `    -- é¡¯ç¤ºç•¶å‰ä½¿ç”¨æ¨¡å‹çš„è³‡è¨Š
	`/available_models`    -- é¡¯ç¤ºç•¶å‰å¯åˆ‡æ›çš„æ¨¡å‹åˆ—è¡¨
	`/change_model    `    -- åˆ‡æ›ä½¿ç”¨çš„æ¨¡å‹
	`/get_help        `    -- é¡¯ç¤ºä½¿ç”¨èªªæ˜
	
	### ä¸€äº›å°æç¤º:
	1. å¦‚æœä½ æœ‰å¤šè¡Œè³‡æ–™è¦å•AIï¼Œå¯ä»¥å…ˆä½¿ç”¨`/set_data`è¼¸å…¥å®Œï¼Œå†ä½¿ç”¨`/ask_ai`æå‡ºå•é¡Œã€‚
	2. ä½ ä¸å¤ªéœ€è¦æ‰‹å‹•æ¸…é™¤å°è©±ç´€éŒ„ï¼Œé–’ç½®è¶…éå…©å°æ™‚çš„å°è©±ç´€éŒ„æœƒè¢«è‡ªå‹•æ¸…é™¤ã€‚
	"""
	    await ctx.followup.send(response)
	```  

17. å•Ÿå‹•æ©Ÿå™¨äººï¼  

	å‰é¢éƒ½æ˜¯Discordæ©Ÿå™¨äººçš„åŠŸèƒ½æ’°å¯«ï¼Œæœ€å¾Œå°±æ˜¯è®“æˆ‘å€‘çš„æ©Ÿå™¨äººä¸Šç·šäº†ï¼ä½¿ç”¨`bot.run(DiscordBot_api_key)`ä¾†è®“æ©Ÿå™¨äººå•Ÿå‹•  

	å¦‚æœæ©Ÿå™¨äººæˆåŠŸç™»éŒ„ï¼Œå°±æœƒå»åŸ·è¡Œå‰é¢çš„`on_ready()`åŒæ­¥æ‰€æœ‰çš„æŒ‡ä»¤åˆ°Discordä¸Šï¼Œä¸¦ä¸”åœ¨py-cordçš„äº‹ä»¶è¿´åœˆå…§ç™»éŒ„æˆ‘çš„è‡ªè¨‚äº‹ä»¶ï¼ˆè‡ªå‹•æ¸…é™¤è¨˜æ†¶ã€å¾Œå°å‘½ä»¤exitåµæ¸¬ï¼‰

	ç•¶æ©Ÿå™¨äººçµæŸåŸ·è¡Œå¾Œï¼Œå‰‡æœƒåœ¨å¾Œå°é¡¯ç¤º`AI Chat Bot is now offline. Press Enter to exit...`ä¸¦ç­‰å¾…ä½¿ç”¨è€…æŒ‰Enteré›¢é–‹ç¨‹å¼

	```Python
	#run the bot
	#if you want to stop this program and make the bot offline safely, just type 'exit'.
	bot.run(DiscordBot_api_key)
	input("AI Chat Bot is now offline. Press Enter to exit...")
	```

ä¸»ç¨‹å¼è¬›è§£å°±åˆ°é€™è£¡  

[â¬…ï¸ ä¸Šä¸€ç« ](ç¬¬ä¸€ç« .md) | [ğŸ“– ç›®éŒ„](README.md) | [ä¸‹ä¸€ç«  â¡ï¸](ç¬¬ä¸‰ç« .md)
